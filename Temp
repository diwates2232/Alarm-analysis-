// craco.config.js
const webpack = require('webpack');
const path = require('path');

module.exports = {
  babel: {
    plugins: [
      '@babel/plugin-proposal-optional-chaining',
      '@babel/plugin-proposal-nullish-coalescing-operator'
    ]
  },
  webpack: {
    configure: (webpackConfig) => {
      // Ensure resolve.alias exists
      webpackConfig.resolve = webpackConfig.resolve || {};
      webpackConfig.resolve.alias = {
        ...(webpackConfig.resolve.alias || {}),

        // Redirect react-router-dom .mjs import to its CJS build
        'react-router-dom/dist/index.mjs': path.resolve(
          __dirname,
          'node_modules/react-router-dom/dist/react-router-dom.cjs.js'
        ),

        // Shim process
        process: require.resolve('process/browser')
      };

      // Only load JS/TS extensions, not .mjs
      webpackConfig.resolve.extensions = ['.js', '.jsx', '.ts', '.tsx'];

      // Provide process globally
      webpackConfig.plugins.push(
        new webpack.ProvidePlugin({
          process: 'process/browser'
        })
      );

      // Ignore temp/locked files when watching
      webpackConfig.watchOptions = {
        ignored: [
          /node_modules/,
          /C:\\DumpStack\.log\.tmp/,
          /\.tmp$/
        ]
      };

      // Also configure devServer watchers if present
      if (webpackConfig.devServer) {
        webpackConfig.devServer.watchFiles = {
          paths: ['src/**/*'],
          options: {
            ignored: [/node_modules/, /\.tmp$/]
          }
        };
      }

      return webpackConfig;
    }
  }
};












// craco.config.js
const webpack = require('webpack');
const path = require('path');

module.exports = {
  babel: {
    plugins: [
      '@babel/plugin-proposal-optional-chaining',
      '@babel/plugin-proposal-nullish-coalescing-operator'
    ]
  },
  webpack: {
    configure: (webpackConfig) => {
      // Ensure resolve.alias exists
      webpackConfig.resolve = webpackConfig.resolve || {};
      webpackConfig.resolve.alias = {
        ...(webpackConfig.resolve.alias || {}),

        // Force react-router-dom imports to use the CJS build (not the .mjs)
        'react-router-dom$': path.resolve(
          __dirname,
          'node_modules/react-router-dom/dist/react-router-dom.cjs.js'
        ),

        // Shim `process` in the browser
        process: require.resolve('process/browser')
      };

      // Remove .mjs from extensions so CRA doesn’t attempt to load it
      webpackConfig.resolve.extensions = [
        '.js',
        '.jsx',
        '.ts',
        '.tsx',
      ];

      // Provide `process` globally for any code referencing process.env
      webpackConfig.plugins.push(
        new webpack.ProvidePlugin({
          process: 'process/browser'
        })
      );

      // Tell Webpack’s watcher to ignore system temp files
      webpackConfig.watchOptions = {
        ignored: [
          /node_modules/,
          /C:\\DumpStack\.log\.tmp/,
          /\.tmp$/,
        ],
      };

      // If devServer is present (CRA >=5), also narrow its watch
      if (webpackConfig.devServer) {
        webpackConfig.devServer.watchFiles = {
          paths: ['src/**/*'],
          options: {
            ignored: [/node_modules/, /\.tmp$/],
          },
        };
      }

      return webpackConfig;
    },
  },
};











// craco.config.js
const webpack = require('webpack');
const path = require('path');

module.exports = {
  babel: {
    plugins: [
      '@babel/plugin-proposal-optional-chaining',
      '@babel/plugin-proposal-nullish-coalescing-operator'
    ]
  },

  webpack: {
    configure: (webpackConfig) => {
      // 1) Point all "react-router-dom" imports at the CJS bundle
      webpackConfig.resolve.alias = {
        ...(webpackConfig.resolve.alias || {}),
        'react-router-dom$': path.resolve(
          __dirname,
          'node_modules/react-router-dom/dist/react-router-dom.cjs.js'
        ),
        process: require.resolve('process/browser')
      };

      // 2) Provide `process` globally if some libs expect it.
      webpackConfig.plugins.push(
        new webpack.ProvidePlugin({ process: 'process/browser' })
      );

      // 3) Tell webpack/chokidar to ignore any .tmp (including DumpStack.log.tmp)
      const ignoredPatterns = ['**/node_modules/**', '**/*.tmp', 'C:/DumpStack.log.tmp'];
      webpackConfig.watchOptions = {
        ...(webpackConfig.watchOptions || {}),
        ignored: ignoredPatterns
      };
      // Also for devServer if CRA 5+
      if (webpackConfig.devServer) {
        webpackConfig.devServer.watchFiles = {
          paths: ['src/**/*'],
          options: { ignored: ignoredPatterns }
        };
      }

      return webpackConfig;
    }
  }
};










(c) Microsoft Corporation. All rights reserved.

C:\Users\W0024618>cd C:\Users\W0024618\Desktop\AlarmAnalysis\alarm-frontend

C:\Users\W0024618\Desktop\AlarmAnalysis\alarm-frontend>npm start

> alarm-frontend@0.1.0 start
> react-scripts --openssl-legacy-provider start
? Something is already running on port 3000.

Would you like to run the app on another port instead? Yes
Starting the development server...

(node:18260) [DEP0060] DeprecationWarning: The `util._extend` API is deprecated. Please use Object.assign() instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
Failed to compile.

./node_modules/react-router-dom/dist/index.mjs
Can't reexport the namespace object from non EcmaScript module (only default export is available)
Error from chokidar (C:\): Error: EBUSY: resource busy or locked, lstat 'C:\DumpStack.log.tmp'
